import React, { useState, useEffect } from 'react';
import { Calendar, MapPin, Clock, Info, ChevronLeft, Search, Phone, Mail, Menu, X, Edit, Plus, Trash2, Save, LogIn, LogOut, ExternalLink, ShieldCheck } from 'lucide-react';

// ***********************************************************************************
// ***********************************************************************************
// ************************** תחילת אזור נתונים לעדכון  *****************************
// ***********************************************************************************
//
//   הוראות לעדכון האתר:
//   1. כל מה שבין הפסים של הכוכביות (***) הוא המידע של האתר.
//   2. כדי לעדכן חוגים או טיולים, משנים רק את הרשימות כאן למטה.
//   3. חשוב מאוד! בכל עדכון, שנה את המספר בשורה SITE_VERSION למספר גבוה יותר (למשל מ-14 ל-15).
//
// ***********************************************************************************

const SITE_VERSION = 15; // עודכן ל-15 כדי לטעון את הנתונים החדשים והמיון

const INITIAL_COURSES = [
  {
    "id": 1,
    "title": "אוריינות דיגיטלית ובינה מלאכותית - מחזור שני",
    "description": "קורס המשלב בתוכו את הבינה המלאכותית, שימוש בסמארטפון ובאפליקציות, צרכנות נבונה ובטיחות ברשת.\nיש שני מועדים:\nיום שלישי - 08:45-10:00\nיום שלישי - 10:30-11:45",
    "image": "https://i.postimg.cc/BZPC3G6n/Photo-Stock-Full-size-excited-elderly-gray-haired-mustache-bearded-man-50s-wear-yellow-shirt-sit-in.jpg",
    "price": "50 ₪ לסדרת המפגשים",
    "schedule": "ימי שלישי",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSfG7jvr6ukUNFOSLoT8r720NB4soN3E_j2BkTqvXVAj2ak35A/viewform?usp=header",
    "active": true
  },
  {
    "id": 2,
    "title": "משבר האקלים - מה צופן לנו העתיד?",
    "description": "איך ייראה משק האנרגיה של העתיד, ומה זה אומר על החיים שלנו כאן ועכשיו?\nמפגש שמאיר את עולם האנרגיה, האתגרים הסביבתיים והפתרונות שכבר נמצאים בדרך.\nלמי שמבקש להבין, לשאול ולחשוב קדימה.",
    "image": "https://i.postimg.cc/prP656Qv/Ecology-Earth-Environment-Photo.jpg",
    "price": "280 ₪ לסמסטר אחד",
    "schedule": "ימי שלישי 8:45-10:00",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSeKaATE1jZ-fqGDvmyXR2fQWb1X4bUxG_2aGg8M_9R0WqcBdg/viewform?usp=header",
    "active": true
  },
  {
    "active": true,
    "title": "המטבח בדרך הטבע",
    "description": "איך אוכלים נכון, בגיל שלנו?\nהרצאות על תזונה, גוף ובריאות, עם דגש על יישום יומיומי ושאלות אמיתיות מהחיים.\nידע עדכני, ברור ורלוונטי למצב הבריאותי של כל אחד.\n\nהקורס מותאם למתחילים וגם למי שכבר למד עם דינה בסמסטר הראשון",
    "price": "280 ₪ לסמסטר אחד",
    "schedule": "ימי שני 8:45-10:00",
    "date": "",
    "image": "https://i.postimg.cc/tJsvQ1c6/Never-realized-this-before.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSf_YhuAVs04VOJmWPMLvjLU8dmusKwRle8AZINzPvvmzZ5VAQ/viewform?usp=publish-editor",
    "id": 1765463548185
  },
  {
    "active": true,
    "title": "גיאולוגיה",
    "description": "מה קורה מתחת לרגליים שלנו?\nקורס מרתק על תהליכים גיאולוגיים, מים, קרקע ונופים, שמסביר איך נוצר העולם שאנחנו חיים בו.\n\nהקורס מותאם לתלמידים חדשים וגם לממשיכים שכבר למדו גיאולוגיה בסמסטר הראשון.",
    "price": "280 ₪ לסמסטר אחד",
    "schedule": "ימי שלישי 10:30-11:45",
    "date": "",
    "image": "https://i.postimg.cc/C17dT58d/Earth-is-eating-itself-A-giant-blob-is-dragging-our-planet-s-crust-and-its-worrying.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLScD7PnB2Ckc2lM5rKK-U7Fa5lkbQN2H_FXmHpAKB4ooXRqntg/viewform?usp=publish-editor",
    "id": 1765463832870
  },
  {
    "active": true,
    "title": "מעגל החיים ביהדות",
    "description": "מסע מרתק בין תחנות החיים, דרך התרבות העברית והיהודית.\nקורס שמזמין התבוננות, שאלות והבנה עמוקה של האדם והקהילה.",
    "price": "280 ₪ לסמסטר אחד",
    "schedule": "יום חמישי 10:30-11:45",
    "date": "",
    "image": "https://i.postimg.cc/k5hjWKkK/prswm-lhwg-m'gl-hhyym.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSefaRcBnhml79I9KaDe4tEZoEsI3HkaDkjH-FArjeaT3sOPIg/viewform?usp=dialog",
    "month": "",
    "id": 1766330499853
  },
  {
    "active": true,
    "title": "סדרת מפגשים עם שמוליק הראלי",
    "description": "סדרה קצרה, של 4 מפגשים על הרעיון הקיבוצי והקמתו בעמק הירדן.\nמבט אזורי ומעמיק על תהליכים ששינו ועדיין משנים את פני המקום.",
    "price": "ללא עלות",
    "schedule": "שלישי 10:30-11:45",
    "date": "",
    "image": "https://i.postimg.cc/7Z5x0wQR/Whats-App-Image-2025-12-29-at-10-01-45.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSej69WxjZr7SLyV8zFm7bFi2-anSn45bCyqPOIEnGG0E3SoFg/viewform?usp=header",
    "month": "",
    "id": 1766926582897
  },
  {
    "active": true,
    "title": "כסף על ים כנרת - לומדים להבין ולנהל את הכסף",
    "description": "סדנה בביתנו",
    "price": "150 ש\"ח לסדרת המפגשים",
    "schedule": "ימי שני 17:00-19:00",
    "date": "",
    "image": "https://i.postimg.cc/QMBwfMQd/knrt.jpg",
    "link": "https://www.mmk.org.il/he/courses/%D7%9B%D7%A1%D7%A3-%D7%A2%D7%9C-%D7%99%D7%9D-%D7%9B%D7%A0%D7%A8%D7%AA-0",
    "month": "",
    "id": 1767092364693
  },
  {
    "active": true,
    "title": "פרקים בתולדות יהדות ארצות הברית",
    "description": "קורס. לסדר את הש\"ח במחיר",
    "price": "280 ש\"ח לסמסטר אחד",
    "schedule": "שלישי 8:45-10:00",
    "date": "",
    "image": "https://i.postimg.cc/V5QS2TC6/hwrdh-(4).jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSeJnVjKwyGLbqStig0ato13dT_JT5tlDGqlKKSFSI_Be3RAzg/viewform?usp=publish-editor",
    "month": "",
    "id": 1767183288584
  },
  {
    "active": true,
    "title": "פלייסטיק",
    "description": "לתקן את ה ש\"ח\nבימים לכתוב שלישי או רביעי?",
    "price": "280 ש\"ח לסמסטר אחד",
    "schedule": "שלישי ורביעי",
    "date": "",
    "image": "https://i.postimg.cc/fR4zjmxH/Whats-App-Image-2025-12-31-at-14-28-37.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSeDCxIak8XlhKq8lEEXUV1a4KWqO4lbfi6_hRSujQtd596okQ/viewform?usp=publish-editor",
    "month": "",
    "id": 1767184105603
  }
];

const INITIAL_TRIPS = [
  {
    "active": true,
    "title": "אילת",
    "description": "נותרו שני חדרים אחרונים, למי לשמור אותם?\nלחצו על הכפתור למטה לפרטים נוספים על הטיול.",
    "price": "2,250 בחדר זוגי",
    "schedule": "",
    "date": "15-18/02/2026",
    "image": "https://i.postimg.cc/BnqgwLnC/'ylt.png",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSdVHNyyGKw7FqyWH2-PKfNnMsU1FR3RWZ4nlK93BD8F9kkp-Q/viewform?usp=dialog",
    "month": "פברואר",
    "id": 1767091673773
  },
  {
    "active": true,
    "title": "הגושרים - גליל עליון",
    "description": "מתוכנן טיול אביבי לגליל המערבי והגליל העליון, לינה בקיבוץ הגושרים. פרטים יפורסמו בהמשך. ",
    "price": "יפורסם בהמשך",
    "schedule": "",
    "date": "26-28/04/2026",
    "image": "https://i.postimg.cc/jdW5Rbhd/hgwsrym.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSeMiWFW7lMyxOSKQn2wEgvj1aQofxCo75wBS20d4z9nyh9Rjg/viewform?usp=publish-editor",
    "month": "אפריל",
    "id": 1766329262694
  },
  {
    "active": true,
    "title": "צפון איטליה עם רן שהם",
    "description": "הטיול שכל כך חיכיתם לו, טיול עומק מאורגן לדולומיטים וצפון איטליה, בשילוב נופים דרמטיים, ערים היסטוריות ואגמים. בהדרכתו המעולה של רן שהם.\n",
    "price": "מופיע בטופס ההרשמה",
    "schedule": "",
    "date": "03-10/05/2026",
    "image": "https://i.postimg.cc/vTj9bbLf/wrwnh.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSeQi04TQ-bvlMoRLUXjczzARjep49yYx0CwecyPXDTTWX5cBg/viewform?usp=publish-editor",
    "month": "מאי",
    "id": 1766671609147
  },
  {
    "active": true,
    "title": "אנדורה וקוסטה בראווה",
    "description": "קול קורא לטיול טבע מרהיב בין הפירנאים לאנדורה, עם נופים דרמטיים, אגמים, רכבלים והליכות קלות.\nשילוב של חוויה, עומק וקצב מותאם לקבוצה.\nלחצו על הקישור למטה לפרטים נוספים",
    "price": "מופיע בטופס ההרשמה",
    "schedule": "",
    "date": "17-24/06/2026",
    "image": "https://i.postimg.cc/g0qSS6x7/'ndwrh.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLScquAxI8_D_iEzQQmC8ZjTwGpDqSmKLh8Qgu4wrBriWFMmzcw/viewform?usp=publish-editor",
    "month": "יוני",
    "id": 1767093132374
  },
  {
    "active": true,
    "title": "טיול קיץ לירושלים ",
    "description": "הטיול המסורתי של מטיילי \"ביתנו\" לירושלים.\nפרטים מלאים בהמשך",
    "price": "יפורסם בהמשך",
    "schedule": "",
    "date": "07-09/07/2026",
    "image": "https://i.postimg.cc/6qz4GLmz/lprswm-lyrwslym.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLScoyzy0QrX6Jae8JE21oB7Bai2t4DB3qDRaJ3Drtela4eTHUQ/viewform?usp=publish-editor",
    "month": "יולי",
    "id": 1766330724698
  },
  {
    "active": true,
    "title": "ונציה עם ירדנה עציון",
    "description": "נצא בהדרכת ירדנה עציון לביקור מודרך בביאנלה של ונציה, אחת מבמות האמנות החשובות בעולם, המתרחשת בתוך עיר שהיא יצירת אמנות בפני עצמה.\nנחקור ונעמיק יחד במה שמבקשת האמנות העכשווית לומר על העולם שבו אנחנו חיים.\n\nפרסום מסודר עם כל הפרטים ייצא בהמשך",
    "price": "יפורסם בהמשך",
    "schedule": "",
    "date": "18-23/10/2026",
    "image": "https://i.postimg.cc/FRr9J55B/wnzyh-lprswm-htywl.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSehzUCp4xJYR0DutsPu6HpMaikqGZI1POqvgOAT5hpCKEHTxA/viewform?usp=publish-editor",
    "month": "אוקטובר",
    "id": 1766330917984
  },
  {
    "id": 1,
    "title": "סדרת טיולים בהליכה נינוחה עם אדם שרמן",
    "description": "טיולי יום קלים, הכוללים הליכה קצרה בטבע, ארוחת צהריים משותפת והדרכה צמודה.",
    "image": "https://i.postimg.cc/W4m14nH6/Whats-App-Image-2025-10-23-at-20-31-37.jpg",
    "price": "משתנה לפי הטיול",
    "date": "משתנה לפי הטיול",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSdtW9WU5_ZZy69t1oawoxYtFyTNRKnGqJux_-kREb8oRPt88A/viewform?usp=header",
    "active": true,
    "month": "סדרת טיולים שנתית"
  },
  {
    "active": true,
    "title": "קהילה צועדת עם חדוה הדר",
    "description": "סדרת טיולים בשבילי הארץ, מיועדת למיטיבי לכת. אם טרם הצטרפתם לקבוצת הווטצאפ של הטיולים, תוכלו להצטרף ושם מופץ המידע על הטיולים.",
    "price": "משתנה לפי הטיול",
    "schedule": "",
    "date": "משתנה לפי הטיול",
    "image": "https://i.postimg.cc/j5rvHscz/Whats-App-Image-2025-12-31-at-15-06-50.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSdjlzF5kQWKbxNfCmi_-IDQ1ANb_xaj5wgnKWZ-MaDNO8y9BA/viewform?usp=publish-editor",
    "month": "סדרת טיולים שנתית",
    "id": 1766329851381
  },
  {
    "active": true,
    "title": "סיורי אומנות עם ירדנה עציון",
    "description": "סדרה המיועדת לסקרנים שבינינו, כאלה שאוהבים להתבונן, לשאול ולפגוש אמנות חיה ונושמת.\nסיורי אמנות עכשווית בהדרכת ירדנה עציון, בגלריות, מוזיאונים ומרחבים ציבוריים.\nהתוכן מותאם לתערוכות המוצגות בזמן אמת, וכולל שיחה, הקשר והשראה.\nהסיורים נינוחים, ללא הליכות ארוכות, ולעיתים משלבים מפגש עם אמנים בשטח.",
    "price": "משתנה לפי הסיור",
    "schedule": "",
    "date": "משתנה לפי הסיור",
    "image": "https://i.postimg.cc/VsKxD0n9/lprswm-sl-yrdnh.jpg",
    "link": "https://docs.google.com/forms/d/e/1FAIpQLSeo7x6oLqO79sazHU-VU4bbi1hkqvu2BlmueF0-dd6L1NmITg/viewform?usp=publish-editor",
    "month": "סדרת סיורים שנתית",
    "id": 1766330247200
  }
];

// ***********************************************************************************
// **************************** סוף אזור נתונים לעדכון  ****************************
// ************************** נא לא לגעת בקוד מתחת לקו זה  *************************
// ***********************************************************************************

// --- רכיבים ומערכת ---

const Header = ({ activeTab, setActiveTab }) => (
  <header className="bg-white shadow-md sticky top-0 z-50">
    <div className="container mx-auto px-4 py-3">
      <div className="flex justify-between items-center">
        <div className="text-xl font-bold text-blue-900 flex items-center gap-2">
          <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
            <MapPin size={20} />
          </div>
          ביתנו - עמק הירדן
        </div>
        
        {/* ניווט למסכים גדולים */}
        <nav className="hidden md:flex gap-6">
          <button 
            onClick={() => setActiveTab('courses')}
            className={`px-4 py-2 rounded-full transition-all font-medium ${
              activeTab === 'courses' 
                ? 'bg-blue-100 text-blue-700 ring-2 ring-blue-500' 
                : 'text-gray-600 hover:bg-gray-50'
            }`}
          >
            חוגים והרצאות
          </button>
          <button 
            onClick={() => setActiveTab('trips')}
            className={`px-4 py-2 rounded-full transition-all font-medium ${
              activeTab === 'trips' 
                ? 'bg-green-100 text-green-700 ring-2 ring-green-500' 
                : 'text-gray-600 hover:bg-gray-50'
            }`}
          >
            טיולים וסיורים
          </button>
        </nav>

        {/* תפריט מובייל פשוט */}
        <div className="flex md:hidden gap-2">
          <button 
            onClick={() => setActiveTab('courses')}
            className={`p-2 rounded-lg ${activeTab === 'courses' ? 'bg-blue-100 text-blue-700' : 'text-gray-500'}`}
          >
            חוגים
          </button>
          <button 
            onClick={() => setActiveTab('trips')}
            className={`p-2 rounded-lg ${activeTab === 'trips' ? 'bg-green-100 text-green-700' : 'text-gray-500'}`}
          >
            טיולים
          </button>
        </div>
      </div>
    </div>
  </header>
);

const ActivityCard = ({ item, type, isAdmin, onEdit, onDelete }) => {
  const isTrip = type === 'trips';
  
  if (!item.active && !isAdmin) return null;

  return (
    <div className={`bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 flex flex-col h-full transition-all hover:shadow-xl ${!item.active ? 'opacity-75 ring-2 ring-red-300' : ''}`}>
      <div className="relative h-48 sm:h-56 overflow-hidden bg-gray-100 group">
        <img 
          src={item.image || "/api/placeholder/400/320"} 
          alt={item.title}
          className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
          onError={(e) => {
            e.target.onerror = null;
            e.target.src = 'https://placehold.co/600x400/e2e8f0/1e293b?text=תמונה+חסרה';
          }}
        />
        {item.month && (
          <div className="absolute top-3 right-3 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-sm font-bold text-gray-800 shadow-sm">
            {item.month}
          </div>
        )}
        {!item.active && isAdmin && (
          <div className="absolute inset-0 flex items-center justify-center bg-black/50 text-white font-bold text-lg">
            לא מפורסם
          </div>
        )}
      </div>

      <div className="p-5 flex-1 flex flex-col">
        <h3 className="text-xl font-bold text-gray-900 mb-2 leading-tight min-h-[3.5rem]">
          {item.title}
        </h3>
        
        <div className="space-y-3 mb-4 flex-1">
          <div className="flex items-start gap-2 text-gray-600 text-sm">
            {isTrip ? <Calendar className="w-4 h-4 mt-1 flex-shrink-0 text-green-600" /> : <Clock className="w-4 h-4 mt-1 flex-shrink-0 text-blue-600" />}
            <span className="font-medium">{item.schedule || item.date || "פרטים בקרוב"}</span>
          </div>
          
          <div className="flex items-start gap-2 text-gray-600 text-sm">
            <span className="font-bold text-gray-400">₪</span>
            <span>{item.price}</span>
          </div>

          <div className="text-gray-600 text-sm whitespace-pre-line line-clamp-4 leading-relaxed">
            {item.description}
          </div>
        </div>

        <div className="mt-auto space-y-3">
          {item.link && (
            <a 
              href={item.link} 
              target="_blank" 
              rel="noopener noreferrer"
              className={`w-full flex items-center justify-center gap-2 py-2.5 px-4 rounded-lg font-medium transition-colors ${
                isTrip 
                  ? 'bg-green-600 hover:bg-green-700 text-white shadow-green-200' 
                  : 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200'
              } shadow-md active:scale-95`}
            >
              <span>לפרטים והרשמה</span>
              <ExternalLink size={16} />
            </a>
          )}
          
          {isAdmin && (
            <div className="flex gap-2 pt-2 border-t border-gray-100">
              <button 
                onClick={() => onEdit(item)}
                className="flex-1 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-center flex items-center justify-center gap-1"
              >
                <Edit size={14} /> עריכה
              </button>
              <button 
                onClick={() => onDelete(item.id)}
                className="py-1.5 px-3 text-sm bg-red-50 hover:bg-red-100 text-red-600 rounded flex items-center justify-center"
              >
                <Trash2 size={14} />
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

const EditModal = ({ isOpen, onClose, item, onSave, type }) => {
  const [formData, setFormData] = useState(item || {});

  useEffect(() => {
    if (item) setFormData({...item});
    else setFormData({ active: true, title: '', description: '', price: '', image: '', link: '', schedule: '', date: '', month: '' });
  }, [item, isOpen]);

  if (!isOpen) return null;

  const handleChange = (e) => {
    const { name, value, type: inputType, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: inputType === 'checkbox' ? checked : value
    }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSave({ ...formData, id: formData.id || Date.now() });
    onClose();
  };

  return (
    <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" style={{direction: 'rtl'}}>
      <div className="bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl">
        <div className="p-6 border-b sticky top-0 bg-white z-10 flex justify-between items-center">
          <h2 className="text-xl font-bold text-gray-800">
            {item?.id ? 'עריכת פריט' : 'הוספת פריט חדש'}
          </h2>
          <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full text-gray-500">
            <X size={20} />
          </button>
        </div>
        
        <form onSubmit={handleSubmit} className="p-6 space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">כותרת</label>
            <input 
              type="text" 
              name="title" 
              value={formData.title} 
              onChange={handleChange} 
              className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" 
              required 
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">תיאור</label>
            <textarea 
              name="description" 
              value={formData.description} 
              onChange={handleChange} 
              rows={4}
              className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none" 
              required 
            />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">מחיר</label>
              <input 
                type="text" 
                name="price" 
                value={formData.price} 
                onChange={handleChange} 
                className="w-full p-2 border rounded-lg" 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {type === 'trips' ? 'תאריך/מועד' : 'לוח זמנים'}
              </label>
              <input 
                type="text" 
                name={type === 'trips' ? 'date' : 'schedule'} 
                value={type === 'trips' ? formData.date : formData.schedule} 
                onChange={handleChange} 
                className="w-full p-2 border rounded-lg" 
              />
            </div>
          </div>

          {type === 'trips' && (
             <div>
               <label className="block text-sm font-medium text-gray-700 mb-1">חודש (לתצוגה)</label>
               <input 
                 type="text" 
                 name="month" 
                 value={formData.month || ''} 
                 onChange={handleChange} 
                 className="w-full p-2 border rounded-lg" 
                 placeholder="לדוגמה: ינואר"
               />
             </div>
          )}

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">קישור לתמונה</label>
            <input 
              type="url" 
              name="image" 
              value={formData.image} 
              onChange={handleChange} 
              className="w-full p-2 border rounded-lg" 
              dir="ltr"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">קישור להרשמה (Google Forms וכו')</label>
            <input 
              type="url" 
              name="link" 
              value={formData.link} 
              onChange={handleChange} 
              className="w-full p-2 border rounded-lg" 
              dir="ltr"
            />
          </div>

          <div className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
            <input 
              type="checkbox" 
              name="active" 
              id="active-check"
              checked={formData.active} 
              onChange={handleChange} 
              className="w-5 h-5 text-blue-600 rounded" 
            />
            <label htmlFor="active-check" className="font-medium text-gray-700">פריט פעיל (מוצג באתר)</label>
          </div>

          <div className="pt-4 flex gap-3">
            <button 
              type="submit" 
              className="flex-1 bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700 flex justify-center items-center gap-2"
            >
              <Save size={18} /> שמירה
            </button>
            <button 
              type="button" 
              onClick={onClose}
              className="flex-1 bg-gray-100 text-gray-700 py-2.5 rounded-lg font-bold hover:bg-gray-200"
            >
              ביטול
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

const AdminLogin = ({ onLogin, onClose }) => {
  const [password, setPassword] = useState('');
  
  const handleSubmit = (e) => {
    e.preventDefault();
    if (password === '1234' || password === 'admin') {
      onLogin();
    } else {
      alert('סיסמה שגויה');
    }
  };

  return (
    <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
      <div className="bg-white rounded-xl p-8 max-w-sm w-full text-center shadow-2xl">
        <div className="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600">
          <ShieldCheck size={32} />
        </div>
        <h2 className="text-2xl font-bold mb-2">כניסת מנהל</h2>
        <p className="text-gray-500 mb-6">אנא הזינו סיסמה לעריכת התוכן</p>
        <form onSubmit={handleSubmit} className="space-y-4">
          <input 
            type="password" 
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full p-3 border rounded-lg text-center text-lg tracking-widest focus:ring-2 focus:ring-blue-500 outline-none"
            placeholder="סיסמה"
            autoFocus
          />
          <div className="flex gap-2">
            <button type="submit" className="flex-1 bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700">כניסה</button>
            <button type="button" onClick={onClose} className="flex-1 bg-gray-100 text-gray-700 py-2 rounded-lg font-bold hover:bg-gray-200">ביטול</button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default function App() {
  const [activeTab, setActiveTab] = useState('courses');
  const [courses, setCourses] = useState([]);
  const [trips, setTrips] = useState([]);
  const [isAdmin, setIsAdmin] = useState(false);
  const [showLogin, setShowLogin] = useState(false);
  const [editingItem, setEditingItem] = useState(null);
  const [isEditModalOpen, setIsEditModalOpen] = useState(false);

  // --- לוגיקת מיון קורסים לפי ימים ---
  const sortCoursesByDay = (coursesList) => {
    const dayOrder = {
      'ראשון': 1, 'שני': 2, 'שלישי': 3, 'רביעי': 4, 
      'חמישי': 5, 'שישי': 6, 'שבת': 7
    };
    
    // פונקציית עזר למציאת ערך מספרי של היום מתוך הטקסט
    const getDayValue = (schedule) => {
      if (!schedule) return 99; // אם אין יום, שים בסוף
      for (const [day, value] of Object.entries(dayOrder)) {
        if (schedule.includes(day)) return value;
      }
      return 99; // אם לא נמצא יום מוכר
    };

    return [...coursesList].sort((a, b) => getDayValue(a.schedule) - getDayValue(b.schedule));
  };

  // טעינת נתונים ראשונית וניהול גרסאות
  useEffect(() => {
    const storedVersion = localStorage.getItem('siteVersion');
    const currentVersion = String(SITE_VERSION);

    if (storedVersion !== currentVersion) {
      // עדכון גרסה - טעינת הנתונים החדשים מהקוד
      console.log('Updating site data to version', currentVersion);
      // מיון הקורסים בטעינה הראשונית
      setCourses(sortCoursesByDay(INITIAL_COURSES));
      setTrips(INITIAL_TRIPS);
      localStorage.setItem('courses', JSON.stringify(sortCoursesByDay(INITIAL_COURSES)));
      localStorage.setItem('trips', JSON.stringify(INITIAL_TRIPS));
      localStorage.setItem('siteVersion', currentVersion);
    } else {
      // טעינה רגילה מהזיכרון המקומי
      const savedCourses = localStorage.getItem('courses');
      const savedTrips = localStorage.getItem('trips');
      
      // וודא מיון גם בטעינה מזיכרון
      if (savedCourses) setCourses(sortCoursesByDay(JSON.parse(savedCourses)));
      else setCourses(sortCoursesByDay(INITIAL_COURSES));
      
      if (savedTrips) setTrips(JSON.parse(savedTrips));
      else setTrips(INITIAL_TRIPS);
    }
  }, []);

  // שמירה לזיכרון בשינויים
  useEffect(() => {
    if (courses.length > 0) localStorage.setItem('courses', JSON.stringify(courses));
  }, [courses]);

  useEffect(() => {
    if (trips.length > 0) localStorage.setItem('trips', JSON.stringify(trips));
  }, [trips]);

  const handleSaveItem = (item) => {
    if (activeTab === 'courses') {
      setCourses(prev => {
        let newCourses;
        const exists = prev.find(c => c.id === item.id);
        if (exists) newCourses = prev.map(c => c.id === item.id ? item : c);
        else newCourses = [...prev, item];
        // מיון מחדש אחרי כל שמירה/הוספה
        return sortCoursesByDay(newCourses);
      });
    } else {
      setTrips(prev => {
        const exists = prev.find(t => t.id === item.id);
        if (exists) return prev.map(t => t.id === item.id ? item : t);
        return [...prev, item];
      });
    }
  };

  const handleDeleteItem = (id) => {
    if (!window.confirm('האם למחוק פריט זה?')) return;
    if (activeTab === 'courses') {
      setCourses(prev => prev.filter(c => c.id !== id));
    } else {
      setTrips(prev => prev.filter(t => t.id !== id));
    }
  };

  const openEdit = (item) => {
    setEditingItem(item);
    setIsEditModalOpen(true);
  };

  const openNew = () => {
    setEditingItem(null);
    setIsEditModalOpen(true);
  };

  const currentItems = activeTab === 'courses' ? courses : trips;

  return (
    <div className="min-h-screen bg-gray-50 text-right font-sans" dir="rtl">
      <Header activeTab={activeTab} setActiveTab={setActiveTab} />

      <main className="container mx-auto px-4 py-8 pb-24">
        {/* כותרת חלק */}
        <div className="flex justify-between items-end mb-8 border-b pb-4">
          <div>
            <h1 className="text-3xl md:text-4xl font-black text-gray-800 mb-2">
              {activeTab === 'courses' ? 'חוגים, הרצאות וסדנאות' : 'טיולים וסיורים'}
            </h1>
            <p className="text-gray-500 text-lg">
              {activeTab === 'courses' 
                ? 'מגוון פעילויות העשרה, גוף ונפש לקהילה' 
                : 'יוצאים לטייל ולהכיר את הארץ והעולם ביחד'
              }
            </p>
          </div>
          
          {isAdmin && (
            <button 
              onClick={openNew}
              className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition-transform active:scale-95"
            >
              <Plus size={20} />
              <span className="hidden sm:inline">הוסף חדש</span>
            </button>
          )}
        </div>

        {/* רשת כרטיסים */}
        {currentItems.length > 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-8">
            {currentItems.map(item => (
              <ActivityCard 
                key={item.id} 
                item={item} 
                type={activeTab} 
                isAdmin={isAdmin}
                onEdit={openEdit}
                onDelete={handleDeleteItem}
              />
            ))}
          </div>
        ) : (
          <div className="text-center py-20 bg-white rounded-2xl shadow-sm border border-dashed border-gray-300">
            <div className="text-gray-400 mb-4 mx-auto w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center">
              <Search size={32} />
            </div>
            <h3 className="text-xl font-bold text-gray-600">אין פעילויות להצגה כרגע</h3>
            <p className="text-gray-400 mt-2">חזרו אלינו בקרוב לעדכונים נוספים</p>
          </div>
        )}
      </main>

      {/* כפתור ניהול צף */}
      <div className="fixed bottom-6 left-6 z-40">
        <button 
          onClick={() => isAdmin ? setIsAdmin(false) : setShowLogin(true)}
          className={`p-3 rounded-full shadow-lg transition-all ${
            isAdmin ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-gray-800 hover:bg-gray-900 text-gray-400 hover:text-white'
          }`}
          title={isAdmin ? "יציאה מניהול" : "כניסת מנהל"}
        >
          {isAdmin ? <LogOut size={24} /> : <LogIn size={24} />}
        </button>
      </div>

      {/* מודלים */}
      {showLogin && (
        <AdminLogin 
          onLogin={() => { setIsAdmin(true); setShowLogin(false); }} 
          onClose={() => setShowLogin(false)} 
        />
      )}

      <EditModal 
        isOpen={isEditModalOpen} 
        onClose={() => setIsEditModalOpen(false)} 
        item={editingItem} 
        onSave={handleSaveItem}
        type={activeTab}
      />
    </div>
  );
}
